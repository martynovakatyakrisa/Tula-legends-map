<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Легенды Тулы - Мобильная карта</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c 0%, #2c3e50 100%);
            color: #333;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        /* Карта занимает весь экран */
        #map {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* Кнопка меню в углу */
        .menu-button {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            color: #2c3e50;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .menu-button:active {
            transform: scale(0.9);
        }
        
        /* Боковая панель с легендами */
        .legends-panel {
            position: absolute;
            top: 0;
            left: -100%;
            width: 90%;
            max-width: 400px;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #4a69bd 100%);
            z-index: 2000;
            transition: left 0.3s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.5);
        }
        
        .legends-panel.open {
            left: 0;
        }
        
        .panel-header {
            padding: 80px 20px 20px 20px;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .panel-header h2 {
            margin-bottom: 10px;
            color: #fdbb2d;
        }
        
        .search-box {
            margin-top: 15px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            outline: none;
        }
        
        .search-input::placeholder {
            color: #7f8c8d;
        }
        
        .legends-list {
            list-style: none;
            padding: 0 15px 20px 15px;
        }
        
        .legend-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .legend-item:active {
            transform: scale(0.98);
        }
        
        .legend-item.active {
            background: rgba(253, 187, 45, 0.2);
            border-color: #fdbb2d;
        }
        
        .legend-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .legend-icon {
            font-size: 1.4em;
            color: #fdbb2d;
            flex-shrink: 0;
            width: 30px;
            text-align: center;
        }
        
        .legend-text {
            flex: 1;
            min-width: 0;
        }
        
        .legend-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 4px;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .legend-preview {
            font-size: 0.85em;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Полноэкранное описание легенды */
        .legend-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 3000;
            transform: translateY(100%);
            transition: transform 0.4s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .legend-fullscreen.open {
            transform: translateY(0);
        }
        
        .fullscreen-header {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #2c3e50 0%, #4a69bd 100%);
            color: white;
            padding: 60px 20px 20px 20px;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .close-fullscreen {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-fullscreen:active {
            transform: scale(0.9);
        }
        
        .fullscreen-content {
            padding: 20px;
            color: #2c3e50;
        }
        
        .fullscreen-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .fullscreen-meta {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4a69bd;
        }
        
        .fullscreen-text {
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .nav-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #4a69bd;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .nav-button:active {
            transform: scale(0.95);
        }
        
        .nav-button.prev {
            background: #7f8c8d;
        }
        
        .nav-button.next {
            background: #27ae60;
        }
        
        /* Кастомные маркеры */
        .custom-marker {
            background: #fdbb2d;
            border: 3px solid white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c3e50;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        /* Затемнение фона */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* Адаптация для маленьких экранов */
        @media (max-width: 480px) {
            .legends-panel {
                width: 85%;
            }
            
            .menu-button {
                top: 15px;
                left: 15px;
                width: 45px;
                height: 45px;
            }
            
            .fullscreen-image {
                height: 180px;
            }
            
            .panel-header {
                padding: 70px 15px 15px 15px;
            }
        }
        
        /* Ландшафтная ориентация */
        @media (orientation: landscape) and (max-height: 500px) {
            .legends-panel {
                width: 70%;
            }
            
            .fullscreen-header {
                padding: 50px 20px 15px 20px;
            }
            
            .fullscreen-image {
                height: 150px;
            }
            
            .panel-header {
                padding: 60px 15px 15px 15px;
            }
        }
        
        /* Стили для скроллбара */
        .legends-panel::-webkit-scrollbar,
        .legend-fullscreen::-webkit-scrollbar {
            width: 6px;
        }
        
        .legends-panel::-webkit-scrollbar-track,
        .legend-fullscreen::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .legends-panel::-webkit-scrollbar-thumb,
        .legend-fullscreen::-webkit-scrollbar-thumb {
            background: #fdbb2d;
            border-radius: 3px;
        }
        
        .no-results {
            text-align: center;
            padding: 30px 20px;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Основная карта -->
        <div id="map"></div>
        
        <!-- Кнопка меню -->
        <button class="menu-button" onclick="toggleLegendsPanel()">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Панель со списком легенд -->
        <div class="legends-panel" id="legendsPanel">
            <div class="panel-header">
                <h2><i class="fas fa-book-open"></i> Легенды Тулы</h2>
                <p>16 мистических историй</p>
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Поиск легенд..." id="searchInput">
                </div>
            </div>
            <ul class="legends-list" id="legendsList">
                <!-- Список будет заполнен JavaScript -->
            </ul>
        </div>
        
        <!-- Полноэкранное описание легенды -->
        <div class="legend-fullscreen" id="legendFullscreen">
            <div class="fullscreen-header">
                <button class="close-fullscreen" onclick="closeFullscreen()">
                    <i class="fas fa-times"></i>
                </button>
                <h2 id="fullscreenTitle"></h2>
                <p id="fullscreenPreview"></p>
            </div>
            <div class="fullscreen-content" id="fullscreenContent">
                <!-- Контент будет заполнен JavaScript -->
            </div>
        </div>
        
        <!-- Затемнение фона -->
        <div class="overlay" id="overlay" onclick="closeAllPanels()"></div>
    </div>

    <script>
        // Полный массив со всеми 16 легендами
        const legends = [
            {
                id: 0,
                coords: [54.1925, 37.6180],
                title: 'Призрак Левши',
                preview: 'Тульский кремль, мастер-оружейник',
                image: 'https://blog.garbuzov-photo.ru/wp-content/uploads/2016/03/CQ0B0642.jpg',
                content: `
                    <img src="https://blog.garbuzov-photo.ru/wp-content/uploads/2016/03/CQ0B0642.jpg" 
                         class="fullscreen-image" alt="Тульский кремль">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Тульский кремль</p>
                        <p><strong>⏳ Время:</strong> XIX век - наши дни</p>
                        <p><strong>🔮 Тип:</strong> Призрак известной личности</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Согласно городской легенде, в стенах древнего Тульского кремля до сих пор обитает дух легендарного мастера-оружейника Левши. Многие посетители и сотрудники музея рассказывают о таинственных явлениях, происходящих в ночное время.</p>
                        <p>Охранники кремля неоднократно слышали характерный звон молота по металлу, доносящийся из пустующих помещений бывших кузнечных мастерских. Некоторые утверждают, что видели силуэт невысокого человека в старинной одежде, склонившегося над верстаком.</p>
                        <p>Историки связывают эту легенду с тем, что Левша стал символом тульских мастеров-умельцев, чьи души не могут найти покой, продолжая творить свои чудеса даже после смерти.</p>
                    </div>
                `
            },
            {
                id: 1,
                coords: [54.3065, 37.5418],
                title: 'Проклятие завода',
                preview: 'Старые цеха оружейного завода',
                image: 'https://avatars.mds.yandex.net/i?id=8f4641e13e24414918efd7ccc67100d9_l-5287999-images-thumbs&n=13',
                content: `
                    <img src="https://avatars.mds.yandex.net/i?id=8f4641e13e24414918efd7ccc67100d9_l-5287999-images-thumbs&n=13" 
                         class="fullscreen-image" alt="Оружейный завод">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Старые цеха оружейного завода</p>
                        <p><strong>⏳ Время:</strong> С XVIII века</p>
                        <p><strong>🔮 Тип:</strong> Проклятие места</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Одна из самых мрачных легенд Тулы связана со старыми цехами оружейного завода. Согласно преданию, первое оружие, созданное здесь для подавления крестьянского восстания, было проклято самими рабочими.</p>
                        <p>Мастера, вынужденные создавать орудия для братоубийственной войны, тайно наложили проклятие на свое творение. Говорят, что каждое такое изделие несет на себе печать скорби и несет несчастье своему владельцу.</p>
                        <p>В архивных записях сохранились упоминания о странных происшествиях: инструменты падали со столов без видимой причины, в пустых цехах слышались вздохи и плач.</p>
                    </div>
                `
            },
            {
                id: 2,
                coords: [54.0421, 37.3146],
                title: 'Зелёная палочка',
                preview: 'Ясная Поляна, усадьба Толстого',
                image: 'https://fsd.multiurok.ru/html/2021/06/18/s_60cc52f487a2d/1705790_1.jpeg',
                content: `
                    <img src="https://fsd.multiurok.ru/html/2021/06/18/s_60cc52f487a2d/1705790_1.jpeg" 
                         class="fullscreen-image" alt="Ясная Поляна">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Усадьба Ясная Поляна</p>
                        <p><strong>⏳ Время:</strong> Детство Л.Н. Толстого (1903-1905)</p>
                        <p><strong>🔮 Тип:</strong> Легенда о счастье</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Эта светлая легенда берет начало в детстве Льва Николаевича Толстого. Его старший брат Николай рассказал младшим, что знает великую тайну всеобщего счастья, которую записал на зеленой палочке и зарыл в лесу Старый Заказ в Ясной Поляне.</p>
                        <p>Брат поведал, что тот, кто найдет эту палочку, узнает секрет, как все люди перестанут грустить, ссориться и болеть, и на земле наступит золотой век. Дети с жаром искали заветную палочку, и эта игра стала для них символом надежды и веры в лучшее будущее.</p>
                        <p>Лев Николаевич так проникся этой идеей, что завещал похоронить себя именно на том месте, где искал зеленую палочку.</p>
                    </div>
                `
            },
            {
                id: 3,
                coords: [53.3623, 38.4030],
                title: 'Шёпот воинов',
                preview: 'Куликово поле, место битвы',
                image: 'https://avatars.dzeninfra.ru/get-zen_doc/3938527/pub_5f3d04c1e541b5095ca6c7ce_5f3d0702b84e994f4fb4f91a/scale_1200',
                content: `
                    <img src="https://avatars.dzeninfra.ru/get-zen_doc/3938527/pub_5f3d04c1e541b5095ca6c7ce_5f3d0702b84e994f4fb4f91a/scale_1200" 
                         class="fullscreen-image" alt="Куликово поле">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Музей-заповедник "Куликово поле"</p>
                        <p><strong>⏳ Время:</strong> С 1380 года</p>
                        <p><strong>🔮 Тип:</strong> Военная легенда</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Куликово поле, место знаменитой битвы 1380 года, овеяно множеством легенд. Самая известная из них гласит, что в туманные утра и тихие вечера здесь можно услышать отголоски великого сражения.</p>
                        <p>Местные жители и посетители музея-заповедника рассказывают о странных звуках: лязге металла, конском топоте, далеких криках на древнерусском языке. Некоторые утверждают, что видели в тумане бестелесные тени воинов, сражающихся друг с другом.</p>
                        <p>Ученые объясняют эти явления особенностями акустики местности и игрой воображения, но многие верят, что земля до сих пор хранит память о кровавой битве.</p>
                    </div>
                `
            },
            {
                id: 4,
                coords: [53.4625, 38.0830],
                title: 'Призрак графини',
                preview: 'Богородицкий дворец',
                image: 'https://masterpiecer-images.s3.yandex.net/1641f777654a11eeb8eaf6f8c1ba65ae:upscaled',
                content: `
                    <img src="https://masterpiecer-images.s3.yandex.net/1641f777654a11eeb8eaf6f8c1ba65ae:upscaled" 
                         class="fullscreen-image" alt="Богородицкий дворец">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Богородицкий дворец-музей</p>
                        <p><strong>⏳ Время:</strong> XVIII век - наши дни</p>
                        <p><strong>🔮 Тип:</strong> Призрак знатной особы</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Богородицкий дворец, бывшая усадьба графов Бобринских, славится своей таинственной обитательницей - призраком графини. Согласно легенде, это дух одной из владелиц усадьбы, которая настолько любила свой дом, что не смогла покинуть его даже после смерти.</p>
                        <p>Сотрудники музея и посетители неоднократно рассказывали о встречах с элегантной дамой в старинном платье, которая появляется в окнах дворца, особенно в сумерки. Призрак не проявляет агрессии, а скорее опекает свое бывшее владение.</p>
                        <p>Интересно, что некоторые утверждают, что видели, как призрачная фигура поправляет экспонаты в музейных залах или любуется видами из окон.</p>
                    </div>
                `
            },
            {
                id: 5,
                coords: [54.1950, 37.6150],
                title: 'Тайна подземных ходов',
                preview: 'Исторический центр Тулы',
                image: 'https://kremltour.ru/wp-content/uploads/2023/05/podzemelya-kremlya.webp',
                content: `
                    <img src="https://kremltour.ru/wp-content/uploads/2023/05/podzemelya-kremlya.webp" 
                         class="fullscreen-image" alt="Исторический центр Тулы">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Исторический центр Тулы</p>
                        <p><strong>⏳ Время:</strong> XVI-XIX века</p>
                        <p><strong>🔮 Тип:</strong> Подземные тайны</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Легенда о сети подземных ходов, соединявших Тульский кремль с монастырями и богатыми домами города. Говорят, что эти ходы использовались для тайных перемещений и хранения ценностей.</p>
                        <p>Многие старожилы утверждают, что в подвалах старых домов до сих пор можно найти замурованные входы в эти тоннели. По некоторым свидетельствам, ходы вели к Упе и использовались для снабжения кремля во время осад.</p>
                        <p>В советское время при строительстве метро и подземных коммуникаций рабочие неоднократно натыкались на древние кирпичные своды, но большинство ходов было засыпано или замуровано.</p>
                    </div>
                `
            },
            {
                id: 6,
                coords: [54.337452, 38.034086],
                title: 'Белая монахиня',
                preview: 'Николо-Венев монастырь',
                image: 'https://sobory.ru/pic/02400/02415_20050722_093318.jpg',
                content: `
                    <img src="https://sobory.ru/pic/02400/02415_20050722_093318.jpg" 
                         class="fullscreen-image" alt="Николо-Венев монастырь">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Николо-Венев монастырь</p>
                        <p><strong>⏳ Время:</strong> XVII век - наши дни</p>
                        <p><strong>🔮 Тип:</strong> Монастырское привидение</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>По легенде, в стенах древнего монастыря обитает призрак монахини в белых одеждах. Она была замурована в стене за нарушение обета и теперь ее дух не может найти покой.</p>
                        <p>Паломники рассказывают о встречах с белой фигурой, которая появляется в лунные ночи и бесшумно скользит по монастырским коридорам. Некоторые слышат тихий плач, доносящийся из-за стен.</p>
                        <p>Местные жители верят, что встреча с Белой монахиней предвещает важные изменения в жизни, но требует особой осторожности - нельзя поворачиваться к призраку спиной.</p>
                    </div>
                `
            },
            {
                id: 7,
                coords: [54.4215, 37.3325],
                title: 'Клад Скуратова',
                preview: 'Дворяниново, усадьба Болотова',
                image: 'https://avatars.mds.yandex.net/i?id=5a6c38885a16013d088382026af6b0b4_l-5316645-images-thumbs&n=13',
                content: `
                    <img src="https://avatars.mds.yandex.net/i?id=5a6c38885a16013d088382026af6b0b4_l-5316645-images-thumbs&n=13" 
                         class="fullscreen-image" alt="Усадьба Дворяниново">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Усадьба Дворяниново</p>
                        <p><strong>⏳ Время:</strong> XVIII век</p>
                        <p><strong>🔮 Тип:</strong> Зарытый клад</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Легенда о спрятанных сокровищах помещика Скуратова, который перед своей смертью закопал семейные драгоценности где-то на территории усадьбы.</p>
                        <p>Многие пытались найти клад, но согласно преданию, его охраняет призрак самого Скуратова, появляющийся в виде старика с клюкой. Тех, кто приближается к кладу, он пугает страшными видениями и звуками.</p>
                        <p>По слухам, клад состоит из золотых монет, фамильного серебра и драгоценных камней, собранных несколькими поколениями семьи Скуратовых.</p>
                    </div>
                `
            },
            {
                id: 8,
                coords: [53.562184, 37.92916],
                title: 'Проклятый пруд',
                preview: 'Старый парк в Крапивне',
                image: 'https://avatars.mds.yandex.net/i?id=1d93918dca70571d9450eebd6da256c2_l-11471706-images-thumbs&n=13',
                content: `
                    <img src="https://avatars.mds.yandex.net/i?id=1d93918dca70571d9450eebd6da256c2_l-11471706-images-thumbs&n=13" 
                         class="fullscreen-image" alt="Пруд в Крапивне">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Старый парк в Крапивне</p>
                        <p><strong>⏳ Время:</strong> XIX век - наши дни</p>
                        <p><strong>🔮 Тип:</strong> Романтическая трагедия</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Местная легенда рассказывает о пруде, в котором утонула молодая девушка-крестьянка, влюбленная в сына помещика. С тех пор ее призрак появляется у воды в лунные ночи.</p>
                        <p>Говорят, что тот, кто увидит ее отражение в воде, обретет любовь, но потеряет покой навсегда. Молодые пары иногда приходят к пруду, чтобы проверить эту легенду.</p>
                        <p>Рыбаки обходят пруд стороной - по их словам, здесь никогда не клюет рыба, а сети возвращаются пустыми или порванными.</p>
                    </div>
                `
            },
            {
                id: 9,
                coords: [53.269331, 38.441837],
                title: 'Каменная баба',
                preview: 'Древнее капище под Тулой',
                image: 'https://c1.35photo.pro/photos_temp/sizes/815/4079015_500n.jpg',
                content: `
                    <img src="https://c1.35photo.pro/photos_temp/sizes/815/4079015_500n.jpg" 
                         class="fullscreen-image" alt="Каменное изваяние">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Окрестности Тулы</p>
                        <p><strong>⏳ Время:</strong> Дославянская эпоха</p>
                        <p><strong>🔮 Тип:</strong> Древнее божество</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Легенда о древнем каменном изваянии, оставшемся от древних народов, населявших эти земли. Местные жители считали, что идол обладает магической силой.</p>
                        <p>По преданию, в полнолуние каменная баба оживает и может либо помочь путнику, либо навести порчу на того, кто проявит к ней неуважение. К ней приходили с просьбами о плодородии и защите.</p>
                        <p>Археологи датируют подобные изваяния IX-XI веками, но местные легенды приписывают им гораздо более древнее происхождение.</p>
                    </div>
                `
            },
            {
                id: 10,
                coords: [54.0546, 37.3409],
                title: 'Призрак Толстого',
                preview: 'Станция Козлова Засека',
                image: 'https://s1.fotokto.ru/photo/full/152/1528259.jpg',
                content: `
                    <img src="https://s1.fotokto.ru/photo/full/152/1528259.jpg" 
                         class="fullscreen-image" alt="Станция Козлова Засека">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Станция Козлова Засека</p>
                        <p><strong>⏳ Время:</strong> С 1910 года</p>
                        <p><strong>🔮 Тип:</strong> Литературный призрак</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>На станции, где отпевали Льва Толстого, иногда видят призрачную фигуру в белом халате. Работники станции рассказывают, что это дух писателя, который до сих пор "ждет поезд" и бродит по перрону в туманные вечера.</p>
                        <p>Особенно часто призрак появляется в годовщину смерти Толстого - 20 ноября. Некоторые утверждают, что слышат его шаги и видят расплывчатый силуэт в сумерках.</p>
                        <p>Литературоведы связывают эту легенду с тем, что Толстой действительно часто бывал на этой станции и даже описал ее в некоторых своих произведениях.</p>
                    </div>
                `
            },
            {
                id: 11,
                coords: [54.1046, 37.3642],
                title: 'Проклятый колокол',
                preview: 'Колокольня Всехсвятского собора',
                image: 'https://img01.kupiprodai.ru/032016/1458067675570.jpg',
                content: `
                    <img src="https://img01.kupiprodai.ru/032016/1458067675570.jpg" 
                         class="fullscreen-image" alt="Всехсвятский собор">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Колокольня Всехсвятского собора</p>
                        <p><strong>⏳ Время:</strong> XIX век</p>
                        <p><strong>🔮 Тип:</strong> Церковная легенда</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Один из колоколов собора якобы отлит из монет, собранных на строительство храма обманом. Староста храма собирал средства с бедняков, обещая им место в раю.</p>
                        <p>В ветреную погоду колокол издает особый, "плачущий" звук, который местные жители называют "гласом совести". Говорят, тот, кто услышит этот звук, должен вспомнить о своих неблаговидных поступках.</p>
                        <p>Священники относятся к этой легенде скептически, но многие прихожане уверены в особой силе этого колокола.</p>
                    </div>
                `
            },
            {
                id: 12,
                coords: [53.5657, 36.4108],
                title: 'Чудотворная икона',
                preview: 'Церковь Воскресения Христова',
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Одоев._Собор_Воскресения_Христова.jpg/548px-Одоев._Собор_Воскресения_Христова.jpg',
                content: `
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Одоев._Собор_Воскресения_Христова.jpg/548px-Одоев._Собор_Воскресения_Христова.jpg" 
                         class="fullscreen-image" alt="Церковь Воскресения Христова">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Церковь Воскресения Христова</p>
                        <p><strong>⏳ Время:</strong> С XVII века</p>
                        <p><strong>🔮 Тип:</strong> Чудотворный образ</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Местная икона Богоматери якобы сама обновляется и мироточит в преддверии важных событий. Монахи рассказывают, что икона "плакала" перед началом войн и революций.</p>
                        <p>В 1941 году, перед оккупацией Тулы, икона якобы замироточила так сильно, что благоухание чувствовалось по всей церкви. Многие верующие считают ее чудотворной и приезжают помолиться о здоровье.</p>
                        <p>Церковные власти официально не подтверждают чудотворность иконы, но и не опровергают рассказы о необычных явлениях.</p>
                    </div>
                `
            },
            {
                id: 13,
                coords: [53.5055, 37.2912],
                title: 'Зеркало графини',
                preview: 'Усадьба Лазарево',
                image: 'https://avatars.dzeninfra.ru/get-zen_doc/5244319/pub_61b33df0aa2d107667189b1c_61b33f9b4413503f4aa7b719/scale_1200',
                content: `
                    <img src="https://avatars.dzeninfra.ru/get-zen_doc/5244319/pub_61b33df0aa2d107667189b1c_61b33f9b4413503f4aa7b719/scale_1200" 
                         class="fullscreen-image" alt="Усадьба Лазарево">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Усадьба Лазарево</p>
                        <p><strong>⏳ Время:</strong> XIX век</p>
                        <p><strong>🔮 Тип:</strong> Зеркальный призрак</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>В одном из зеркал усадьбы застрял дух молодой графини, которая трагически погибла перед своей свадьбой. Согласно легенде, она так любила смотреться в это зеркало, что ее дух не смог покинуть его.</p>
                        <p>Если долго смотреть в зеркало в полночь, можно увидеть ее отражение - молодую девушку в свадебном платье. Некоторые посетители утверждают, что чувствуют холодное прикосновение, когда подходят к зеркалу.</p>
                        <p>Сотрудники музея шутят, что графиня до сих пор "следит за порядком" в своем любимом доме.</p>
                    </div>
                `
            },
            {
                id: 14,
                coords: [54.4314, 37.2923],
                title: 'Говорящий дуб',
                preview: 'Село Савино, древний дуб',
                image: 'https://cdn.culture.ru/images/9abd30b6-187a-5cd8-aa4b-11c0053c65b6',
                content: `
                    <img src="https://cdn.culture.ru/images/9abd30b6-187a-5cd8-aa4b-11c0053c65b6" 
                         class="fullscreen-image" alt="Древний дуб">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Село Савино</p>
                        <p><strong>⏳ Время:</strong> Более 300 лет</p>
                        <p><strong>🔮 Тип:</strong> Волшебное дерево</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>Древний дуб, под которым якобы отдыхал Петр I во время своих поездок по России, "шепчет" предсказания путникам в ветреную погоду. Местные жители считают дерево священным.</p>
                        <p>Согласно поверью, если приложить ухо к стволу в полнолуние, можно услышать голос, который даст совет или предскажет будущее. Многие молодые пары приезжают к дубу, чтобы попросить о крепкой любви.</p>
                        <p>Ботаники подтверждают, что дубу действительно более 300 лет, что делает его одним из старейших деревьев в Тульской области.</p>
                    </div>
                `
            },
            {
                id: 15,
                coords: [53.5642, 36.4256],
                title: 'Подземный монах',
                preview: 'Анастасов монастырь',
                image: 'https://belev-eparhia.ru/wp-content/uploads/Анастасов-монастырь-1.jpg',
                content: `
                    <img src="https://belev-eparhia.ru/wp-content/uploads/Анастасов-монастырь-1.jpg" 
                         class="fullscreen-image" alt="Анастасов монастырь">
                    <div class="fullscreen-meta">
                        <p><strong>📍 Место:</strong> Анастасов монастырь</p>
                        <p><strong>⏳ Время:</strong> С XVIII века</p>
                        <p><strong>🔮 Тип:</strong> Монах-отшельник</p>
                    </div>
                    <div class="fullscreen-text">
                        <p>В подземельях монастыря живет старец-отшельник, который молится за весь мир и появляется только избранным. Согласно легенде, он был замурован в келье по собственному желанию.</p>
                        <p>Паломники рассказывают, что в тишине монастырских подвалов иногда слышны молитвы, а в особенно трудные для России времена старец выходит на поверхность, чтобы помочь страждущим.</p>
                        <p>Монахи не подтверждают и не опровергают эту легенду, говоря, что "в монастыре много тайн, которые лучше не тревожить".</p>
                    </div>
                `
            }
        ];

        // Инициализация карты
        let map = L.map('map').setView([54.1931, 37.6173], 11);
        
        // Добавление слоя OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 18,
            minZoom: 8
        }).addTo(map);
        
        let currentLegendId = 0;
        
        // Заполняем список легенд
        const legendsList = document.getElementById('legendsList');
        
        function renderLegendsList(filteredLegends = legends) {
            legendsList.innerHTML = '';
            
            if (filteredLegends.length === 0) {
                legendsList.innerHTML = '<div class="no-results">Ничего не найдено</div>';
                return;
            }
            
            filteredLegends.forEach(legend => {
                const li = document.createElement('li');
                li.className = 'legend-item';
                li.innerHTML = `
                    <div class="legend-header">
                        <div class="legend-icon"><i class="fas fa-${getIconName(legend.id)}"></i></div>
                        <div class="legend-text">
                            <div class="legend-title">${legend.title}</div>
                            <div class="legend-preview">${legend.preview}</div>
                        </div>
                    </div>
                `;
                li.onclick = () => {
                    showLegendFullscreen(legend.id);
                    closeLegendsPanel();
                };
                legendsList.appendChild(li);
            });
        }
        
        // Изначально рендерим все легенды
        renderLegendsList();

        // Добавление меток на карту
        const markers = [];
        
        legends.forEach((legend, index) => {
            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `<i class="fas fa-${getIconName(index)}"></i>`,
                iconSize: [45, 45],
                iconAnchor: [22, 22]
            });
            
            const marker = L.marker(legend.coords, {icon: customIcon}).addTo(map);
            
            // При клике на маркер сразу открываем полноэкранное описание
            marker.on('click', () => {
                showLegendFullscreen(legend.id);
            });
            
            marker.bindPopup(`
                <div style="text-align: center; max-width: 250px;">
                    <h4 style="margin: 0 0 8px 0; color: #2c3e50;">${legend.title}</h4>
                    <img src="${legend.image}" style="width: 100%; height: 100px; object-fit: cover; border-radius: 6px; margin: 4px 0;">
                    <p style="margin: 8px 0; font-size: 13px;">${legend.preview}</p>
                    <button onclick="showLegendFullscreen(${legend.id})" style="background: #4a69bd; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 12px; width: 100%;">
                        <i class="fas fa-expand"></i> Читать полностью
                    </button>
                </div>
            `);
            
            markers.push(marker);
        });
        
        function getIconName(index) {
            const icons = [
                'ghost', 'industry', 'tree', 'shield-alt', 'crown', 'door-open', 
                'church', 'coins', 'water', 'monument', 'train', 'bell', 
                'cross', 'mirror', 'tree', 'pray'
            ];
            return icons[index] || 'map-marker';
        }
        
        // Управление панелями
        function toggleLegendsPanel() {
            const panel = document.getElementById('legendsPanel');
            const overlay = document.getElementById('overlay');
            panel.classList.toggle('open');
            overlay.classList.toggle('visible');
        }
        
        function closeLegendsPanel() {
            const panel = document.getElementById('legendsPanel');
            const overlay = document.getElementById('overlay');
            panel.classList.remove('open');
            overlay.classList.remove('visible');
        }
        
        function showLegendFullscreen(legendId) {
            const legend = legends[legendId];
            const fullscreen = document.getElementById('legendFullscreen');
            const title = document.getElementById('fullscreenTitle');
            const preview = document.getElementById('fullscreenPreview');
            const content = document.getElementById('fullscreenContent');
            
            currentLegendId = legendId;
            
            title.textContent = legend.title;
            preview.textContent = legend.preview;
            
            // Добавляем кнопки навигации
            const navigationButtons = `
                <div class="navigation-buttons">
                    <button class="nav-button prev" onclick="showPreviousLegend()" ${legendId === 0 ? 'disabled style="opacity: 0.5"' : ''}>
                        <i class="fas fa-arrow-left"></i> Предыдущая
                    </button>
                    <button class="nav-button next" onclick="showNextLegend()" ${legendId === legends.length - 1 ? 'disabled style="opacity: 0.5"' : ''}>
                        Следующая <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `;
            
            content.innerHTML = legend.content + navigationButtons;
            fullscreen.classList.add('open');
            
            // Центрируем карту на выбранной легенде
            map.setView(legend.coords, 14);
            
            // Открываем popup у маркера
            markers[legendId].openPopup();
        }
        
        function showPreviousLegend() {
            if (currentLegendId > 0) {
                showLegendFullscreen(currentLegendId - 1);
            }
        }
        
        function showNextLegend() {
            if (currentLegendId < legends.length - 1) {
                showLegendFullscreen(currentLegendId + 1);
            }
        }
        
        function closeFullscreen() {
            const fullscreen = document.getElementById('legendFullscreen');
            fullscreen.classList.remove('open');
        }
        
        function closeAllPanels() {
            closeLegendsPanel();
            closeFullscreen();
        }
        
        // Поиск по легендам
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                renderLegendsList(legends);
                return;
            }
            
            const filteredLegends = legends.filter(legend => 
                legend.title.toLowerCase().includes(searchTerm) ||
                legend.preview.toLowerCase().includes(searchTerm) ||
                legend.content.toLowerCase().includes(searchTerm)
            );
            
            renderLegendsList(filteredLegends);
        });
        
        // Закрытие по клику на overlay
        document.getElementById('overlay').addEventListener('click', closeAllPanels);
        
        // Закрытие по ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllPanels();
            }
        });
        
        // Обработка изменения ориентации
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                map.invalidateSize();
            }, 300);
        });
        
        // Автоматическое открытие первой легенды при загрузке
        setTimeout(() => {
            showLegendFullscreen(0);
        }, 1000);
    </script>
</body>

</html>
